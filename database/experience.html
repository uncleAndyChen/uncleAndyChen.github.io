<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    

    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<!--<script async src="//hm.baidu.com/hm.js?aa00e68c93e65cfd9c15a0fcb787287c"></script>-->
<!-- 统计-->
<script>
    var _hmt = _hmt || [];
    (function() {
        var host = window.location.host;
        var hm = document.createElement("script");

        if (host.indexOf('gitee.io') > 0) { // https://uncleandychen.gitee.io/
            hm.src = "https://hm.baidu.com/hm.js?0cf4709148b070b8082191d2e456a1a3";
        } else if (host.indexOf('lovesofttech.com') > 0) { // https://www.lovesofttech.com/
            hm.src = "https://hm.baidu.com/hm.js?aa00e68c93e65cfd9c15a0fcb787287c";
        } else {
            hm.src = '';
        }

        if (hm.src !== '') {
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        }
    })();
</script>
<!-- End Baidu Tongji -->



<!-- Baidu Push -->
<!-- 主动推送百度爬虫-->
<script>
    (function(){
        if (window.location.host.indexOf('lovesofttech.com') < 0) {
            return;
        }

        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }

        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
<!-- End Baidu Push -->


    <meta charset="utf-8">
    
    
    <link rel="canonical" href="https://www.lovesofttech.com/database/experience.html">
    
    
    <title>MySQL 常用脚本，日常经验 | 安迪陈技术日志，架构、感悟、系统分析、团队管理 | 自强不息，厚德载物</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="MySQL">
    <meta name="description" content="MySQL 高频脚本备忘录，以及日常经验备忘。">
<meta name="keywords" content="MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 常用脚本，日常经验">
<meta property="og:url" content="https://www.lovesofttech.com/database/experience.html">
<meta property="og:site_name" content="安迪陈技术日志，架构、感悟、系统分析、团队管理">
<meta property="og:description" content="MySQL 高频脚本备忘录，以及日常经验备忘。">
<meta property="og:locale" content="zh-cn">
<meta property="og:image" content="https://www.lovesofttech.com/img/MySQLWorkbench/MySQLWorkbenchSafeUpdates.png">
<meta property="og:updated_time" content="2020-09-01T02:53:12.919Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySQL 常用脚本，日常经验">
<meta name="twitter:description" content="MySQL 高频脚本备忘录，以及日常经验备忘。">
<meta name="twitter:image" content="https://www.lovesofttech.com/img/MySQLWorkbench/MySQLWorkbenchSafeUpdates.png">
    
        <link rel="alternative" href="/atom.xml" title="安迪陈技术日志，架构、感悟、系统分析、团队管理" type="application/atom+xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=201912302211">
    <link rel="stylesheet" href="/css/header.css?v=201912302211">
    <script>window.lazyScripts=[]</script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu">
  <div class="inner flex-row-vertical">
    <!--<i class="icon icon-lg icon-close"></i>-->
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off" title="隐藏左侧导航">﹤<i class="icon icon-lg icon-navicon"></i></a>
    <div class="brand-wrap" style="background-image:url(/img/bannerBackgroundLeft.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/myLogo.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">安迪陈</h5>
          <a href="mailto:andy@lovesofttech.com" title="andy@lovesofttech.com" class="mail" rel="external nofollow noopener noreferrer" target="_blank">andy@lovesofttech.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/">
                <i class="icon icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/articleClassify.html">
                <i class="icon icon-th-list"></i>
                文章分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/articles.html">
                <i class="icon icon-th-list articles"></i>
                文章列表
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/java.html">
                <i class="icon icon-th-list java"></i>
                Java
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/database.html">
                <i class="icon icon-th-list database"></i>
                MySQL/MyBatis
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/linux.html">
                <i class="icon icon-th-list linux"></i>
                CentOS/linux
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/react.html">
                <i class="icon icon-th-list React"></i>
                React
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/lnmp.html">
                <i class="icon icon-th-list LNMP"></i>
                LNMP
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/git.html">
                <i class="icon icon-th-list git"></i>
                git
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/windows.html">
                <i class="icon icon-th-list windows"></i>
                windows
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/dailyLives.html">
                <i class="icon icon-th-list dailyLives"></i>
                工作 &amp; 生活
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives">
                <i class="icon icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags">
                <i class="icon icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/uncleAndyChen" target="_blank" rel="external nofollow noopener noreferrer">
                <i class="icon icon-github"></i>
                我的 github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://gitee.com/uncleAndyChen" target="_blank" rel="external nofollow noopener noreferrer">
                <i class="icon icon-link"></i>
                我的 gitee
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://blog.csdn.net/runAndRun" target="_blank" rel="external nofollow noopener noreferrer">
                <i class="icon icon-link CSDN"></i>
                我的 CSDN
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/aboutMe.html">
                <i class="icon icon-address-card"></i>
                关于我
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">

        <div class="navbar navbar-custom navbar-fixed-top">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" style="margin-left:10px;" id="menu-toggle" title="显示左侧导航"><i class="icon icon-lg icon-navicon"></i>﹥</a>
            <ul class="nav navbar-nav navbar-right" id="navMenuTop">
                <li>
                    <a href="/">主页</a>
                </li>
                
                    
                        <li>
                            <a href="/articleClassify.html" title="本博客的文章分类列表">文章分类</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="/articles.html" title="本博客的所有文章列表">文章列表</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="/java.html" title="Java 开发，文章目录">Java</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="/database.html" title="日常开发中有关 MySQL、MyBatis 的一些经验总结">MySQL/MyBatis</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="/linux.html" title="CentOS/linux，文章目录">CentOS/linux</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="/react.html" title="React 技术栈（全家桶）学习心得分享，文章目录">React</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="/about.html">关于</a>
                        </li>
                    
                
            </ul>
        </div>

        <div class="flex-col header-title ellipsis">MySQL 常用脚本，日常经验</div>
        
        <div class="search-wrap" id="search-wrap" style="z-index: 2;">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back" style="width:33px;">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search" style="width:33px;">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare" style="z-index: 3;margin-right: 10px; width:30px;">
                <i class="icon icon-lg icon-share-alt"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h2 class="title">MySQL 常用脚本，日常经验</h2>
        <h5 class="subtitle">
            
                <time datetime="2017-06-18T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2017-06-19
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/MySQL/">MySQL</a></li></ul>

            
        </h5>
    </div>

    

</header>


<div class="container body-wrap" id="index-container">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc" style="z-index: 3;">
            <h4><i class="fa fa-list-alt"></i>&nbsp;&nbsp;本文目录</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#在终端连接-MySQL"><span class="post-toc-number">1.</span> <span class="post-toc-text">在终端连接 MySQL</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#结论"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">结论</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#sql-safe-updates"><span class="post-toc-number">2.</span> <span class="post-toc-text">sql_safe_updates</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#临时解决"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">临时解决</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#永久解决"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">永久解决</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#时间函数"><span class="post-toc-number">3.</span> <span class="post-toc-text">时间函数</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#MYSQL-事件"><span class="post-toc-number">4.</span> <span class="post-toc-text">MYSQL 事件</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#mysql-修改自增列的起始值"><span class="post-toc-number">5.</span> <span class="post-toc-text">mysql 修改自增列的起始值</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#mysql-超时时间设置"><span class="post-toc-number">6.</span> <span class="post-toc-text">mysql 超时时间设置</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#关于-information-schema-库"><span class="post-toc-number">7.</span> <span class="post-toc-text">关于 information_schema 库</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#以下是information-schema数据库中的表"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">以下是information_schema数据库中的表</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#在-information-schema-库中查看索引信息"><span class="post-toc-number">8.</span> <span class="post-toc-text">在 information_schema 库中查看索引信息</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#在-information-schema-库中查看表信息"><span class="post-toc-number">9.</span> <span class="post-toc-text">在 information_schema 库中查看表信息</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#查询表中数据超过-1000-行的表"><span class="post-toc-number">10.</span> <span class="post-toc-text">查询表中数据超过 1000 行的表</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#查询所有没有主键的表"><span class="post-toc-number">11.</span> <span class="post-toc-text">查询所有没有主键的表</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#查询-5-个最大表"><span class="post-toc-number">12.</span> <span class="post-toc-text">查询 5 个最大表</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#查看连接情况"><span class="post-toc-number">13.</span> <span class="post-toc-text">查看连接情况</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#查看-MySQL-版本"><span class="post-toc-number">14.</span> <span class="post-toc-text">查看 MySQL 版本</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#查看-mysql-现在已提供什么存储引擎"><span class="post-toc-number">15.</span> <span class="post-toc-text">查看 mysql 现在已提供什么存储引擎</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#查看-mysql-当前默认的存储引擎"><span class="post-toc-number">16.</span> <span class="post-toc-text">查看 mysql 当前默认的存储引擎</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#提升插入速度"><span class="post-toc-number">17.</span> <span class="post-toc-text">提升插入速度</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#MY-SQL-insert-速度过慢的解决方法"><span class="post-toc-number">17.1.</span> <span class="post-toc-text">MY SQL insert 速度过慢的解决方法</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#decimal-精度"><span class="post-toc-number">18.</span> <span class="post-toc-text">decimal 精度</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#多表关联-update"><span class="post-toc-number">19.</span> <span class="post-toc-text">多表关联 update</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#密码强度"><span class="post-toc-number">20.</span> <span class="post-toc-text">密码强度</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#查看错误日志文件路径"><span class="post-toc-number">21.</span> <span class="post-toc-text">查看错误日志文件路径</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#查看表结构"><span class="post-toc-number">22.</span> <span class="post-toc-text">查看表结构</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#mysql-8-x-查看存储过程"><span class="post-toc-number">23.</span> <span class="post-toc-text">mysql 8.x 查看存储过程</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#查看函数的创建代码"><span class="post-toc-number">24.</span> <span class="post-toc-text">查看函数的创建代码</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#mysqldump-导出数据"><span class="post-toc-number">25.</span> <span class="post-toc-text">mysqldump 导出数据</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#导入数据"><span class="post-toc-number">26.</span> <span class="post-toc-text">导入数据</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#授权"><span class="post-toc-number">27.</span> <span class="post-toc-text">授权</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#远程连接权限设置"><span class="post-toc-number">27.1.</span> <span class="post-toc-text">远程连接权限设置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#查看-MYSQL-数据库用户远程连接权限"><span class="post-toc-number">27.2.</span> <span class="post-toc-text">查看 MYSQL 数据库用户远程连接权限</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2019-06-10-补充"><span class="post-toc-number">27.2.1.</span> <span class="post-toc-text">2019-06-10 补充</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#直接修改授权-IP"><span class="post-toc-number">27.2.2.</span> <span class="post-toc-text">直接修改授权 IP</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#删除授权"><span class="post-toc-number">27.3.</span> <span class="post-toc-text">删除授权</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#MySQL-获取当前年"><span class="post-toc-number">28.</span> <span class="post-toc-text">MySQL 获取当前年</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#MySQL-int-后面的数字与前导零填充"><span class="post-toc-number">29.</span> <span class="post-toc-text">MySQL int 后面的数字与前导零填充</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#ERROR-1273-HY000-Unknown-collation-‘utf8mb4-0900-ai-ci’"><span class="post-toc-number">30.</span> <span class="post-toc-text">ERROR 1273 (HY000): Unknown collation: ‘utf8mb4_0900_ai_ci’</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#解决"><span class="post-toc-number">30.1.</span> <span class="post-toc-text">解决</span></a></li></ol></li></ol>
        </nav>
    </aside>
    

<article id="post-database/experience" class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">MySQL 常用脚本，日常经验</h1>
        <div class="post-meta">
            <time class="post-time" title="2017年06月19日 0:00" datetime="2017-06-18T16:00:00.000Z" itemprop="datePublished">2017-06-19</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/MySQL/">MySQL</a></li></ul>



            
<span id="busuanzi_container_page_pv" style="display:none">
    阅读量：<span id="busuanzi_value_page_pv"></span>次
</span>


    <span>|</span>
    <span class="post-count">字数：5.3k</span>
    <span>|</span>
    <span class="post-count">阅读时长：大约24分钟</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>MySQL 高频脚本备忘录，以及日常经验备忘。<br><a id="more"></a></p>
<h1 id="在终端连接-MySQL"><a href="#在终端连接-MySQL" class="headerlink" title="在终端连接 MySQL"></a>在终端连接 MySQL</h1><p>假设 MySQL 的密码是：<code>#mysqlPassword!#</code>，主机 IP 是：<code>192.168.1.230</code>，用户名是：<code>root</code>。在 win10 的 cmd 窗口下，用以下脚本可直接连接。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h192.168.1.230 -uroot -p#mysqlPassword!#</span><br></pre></td></tr></table></figure></p>
<p>把用户名用单引号引起来，密码不引，也可以直接连接。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h192.168.1.230 -u&apos;root&apos; -p#mysqlPassword!#</span><br></pre></td></tr></table></figure></p>
<p>但是，如果把密码用单引号引起来，则会提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1045 (28000): Access denied for user &apos;root&apos;@&apos;192.168.1.89&apos; (using password: YES)</span><br></pre></td></tr></table></figure></p>
<p>没有权限时（换一个 IP：192.168.1.29 连接测试），会提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1130 (HY000): Host &apos;192.168.1.29&apos; is not allowed to connect to this MySQL server</span><br></pre></td></tr></table></figure></p>
<p>SecureCRT 用以下脚本可直接连接，密码前后的单引号是必须的，否则会不识别密码，而用户名则可以引起来也可以不引。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u&apos;root&apos; -p&apos;#mysqlPassword!#&apos;</span><br></pre></td></tr></table></figure></p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>在终端连接 MySQL时，关于单引号的使用，win10 与 SecureCRT 是有区别的。</p>
<ol>
<li>密码，win10 下不能用单引号引起来，而 SecureCRT 则必须要用单引号引起来。</li>
<li>主机 IP 地址，在 win10 下，不能用单引号引起来，否则报以下错误，而 SecureCRT 则可用单引号引起来，也可不用。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\AndyChen&gt;mysql -h&apos;192.168.1.230&apos; -uroot -p#mysqlPassword!#</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">ERROR 2005 (HY000): Unknown MySQL server host &apos;&apos;192.168.1.230&apos;&apos; (2)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="sql-safe-updates"><a href="#sql-safe-updates" class="headerlink" title="sql_safe_updates"></a>sql_safe_updates</h1><p>用 MySQL Workbench，执行批量更新、删除时，报错。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error Code: 1175. You are using safe update mode and you tried to update a table without a WHERE that uses a KEY column To disable safe mode, toggle the option in Preferences -&gt; SQL Editor and reconnect.	0.000 sec</span><br></pre></td></tr></table></figure></p>
<p>MySQL Workbench 默认阻止这种批量修改删除操作，是为了防止我们由于误操作而导致的全表数据更新，因此强制我们必须使用有效的 where 语句来限制。</p>
<h2 id="临时解决"><a href="#临时解决" class="headerlink" title="临时解决"></a>临时解决</h2><p>可在 MySQL Workbench 查询窗口执行以下语句临时支持批量修改和删除：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set sql_safe_updates = 0;</span><br></pre></td></tr></table></figure></p>
<p>但重启 MySQL Workbench 后会失效。 </p>
<h2 id="永久解决"><a href="#永久解决" class="headerlink" title="永久解决"></a>永久解决</h2><p>修改配置，其配置项如下（edit -&gt; preference -&gt; SQL Editor -&gt; Safe Updates(rejects UPDATEs and DELETEs with no restrictions)）：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/MySQLWorkbench/MySQLWorkbenchSafeUpdates.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure></p>
<p>该项默认是勾选状态，取消勾选，重启 MySQLWorkbench 生效。不过，如此设置之后，建议 MySQL Workbench 只连接开发和测试环境，不要连接生产环境以避免灾难性失误。</p>
<h1 id="时间函数"><a href="#时间函数" class="headerlink" title="时间函数"></a>时间函数</h1><ol>
<li><p>将时间戳格式化为能看懂的时间格式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM_UNIXTIME(created, '%Y-%m-%d %H:%i:%s') as createdF</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回当前时间的UNIX时间戳</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select UNIX_TIMESTAMP(NOW()) from dual;</span><br><span class="line">select unix_timestamp() from dual;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="MYSQL-事件"><a href="#MYSQL-事件" class="headerlink" title="MYSQL 事件"></a>MYSQL 事件</h1><ol>
<li><p>查看 event_scheduler 状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &apos;%sche%&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改 event_scheduler 状态</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global event_scheduler=1;</span><br></pre></td></tr></table></figure>
<p> 这种方式开启后，重启 MySQL 后，JOB 功能又 OFF 了，所以，还需要修改配置文件，以开启 JOB 功能。开启方法：在 <code>my.cnf</code> 添加 <code>mysqlid event_scheduler=ON</code></p>
</li>
<li>创建 MYSQL 事件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line">CREATE event event_tb_push_data_backup</span><br><span class="line">ON SCHEDULE</span><br><span class="line">EVERY 5 MINUTE</span><br><span class="line">STARTS NOW()</span><br><span class="line">DO</span><br><span class="line">BEGIN</span><br><span class="line">    CALL event_tb_push_data_backup();</span><br><span class="line">END;</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="mysql-修改自增列的起始值"><a href="#mysql-修改自增列的起始值" class="headerlink" title="mysql 修改自增列的起始值"></a>mysql 修改自增列的起始值</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tableName AUTO_INCREMENT=<span class="number">100000066</span>;</span><br></pre></td></tr></table></figure>
<h1 id="mysql-超时时间设置"><a href="#mysql-超时时间设置" class="headerlink" title="mysql 超时时间设置"></a>mysql 超时时间设置</h1><p>设置全局变量 connect_timeout 为12小时（12*3600=43200）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MySQL [(none)]&gt; SET GLOBAL connect_timeout = 43200;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>再次查看，确认参数是否修改成功<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MySQL [(none)]&gt; show global variables like &apos;%timeout%&apos;;</span><br><span class="line">+----------------------------------------+--------------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+----------------------------------------+--------------+</span><br><span class="line">| connect_timeout | 43200 |</span><br></pre></td></tr></table></figure></p>
<h1 id="关于-information-schema-库"><a href="#关于-information-schema-库" class="headerlink" title="关于 information_schema 库"></a>关于 information_schema 库</h1><p>information_schema是一个虚拟数据库，并不物理存在，在select的时候，从其他数据库获取相应的信息。</p>
<h2 id="以下是information-schema数据库中的表"><a href="#以下是information-schema数据库中的表" class="headerlink" title="以下是information_schema数据库中的表"></a>以下是information_schema数据库中的表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use information_schema</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup <span class="keyword">with</span> -A</span><br><span class="line"></span><br><span class="line"><span class="keyword">Database</span> <span class="keyword">changed</span></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">tables</span>;</span><br><span class="line">+<span class="comment">---------------------------------------+</span></span><br><span class="line">| Tables_in_information_schema          |</span><br><span class="line">+<span class="comment">---------------------------------------+</span></span><br><span class="line">| CHARACTER_SETS                        |</span><br><span class="line">| COLLATIONS                            |</span><br><span class="line">| COLLATION_CHARACTER_SET_APPLICABILITY |</span><br><span class="line">| COLUMNS                               |</span><br><span class="line">| COLUMN_PRIVILEGES                     |</span><br><span class="line">| ENGINES                               |</span><br><span class="line">| EVENTS                                |</span><br><span class="line">| FILES                                 |</span><br><span class="line">| GLOBAL_STATUS                         |</span><br><span class="line">| GLOBAL_VARIABLES                      |</span><br><span class="line">| KEY_COLUMN_USAGE                      |</span><br><span class="line">| OPTIMIZER_TRACE                       |</span><br><span class="line">| PARAMETERS                            |</span><br><span class="line">| PARTITIONS                            |</span><br><span class="line">| PLUGINS                               |</span><br><span class="line">| PROCESSLIST                           |</span><br><span class="line">| PROFILING                             |</span><br><span class="line">| REFERENTIAL_CONSTRAINTS               |</span><br><span class="line">| ROUTINES                              |</span><br><span class="line">| SCHEMATA                              |</span><br><span class="line">| SCHEMA_PRIVILEGES                     |</span><br><span class="line">| SESSION_STATUS                        |</span><br><span class="line">| SESSION_VARIABLES                     |</span><br><span class="line">| STATISTICS                            |</span><br><span class="line">| TABLES                                |</span><br><span class="line">| TABLESPACES                           |</span><br><span class="line">| TABLE_CONSTRAINTS                     |</span><br><span class="line">| TABLE_PRIVILEGES                      |</span><br><span class="line">| TRIGGERS                              |</span><br><span class="line">| USER_PRIVILEGES                       |</span><br><span class="line">| VIEWS                                 |</span><br><span class="line">| INNODB_LOCKS                          |</span><br><span class="line">| INNODB_TRX                            |</span><br><span class="line">| INNODB_SYS_DATAFILES                  |</span><br><span class="line">| INNODB_LOCK_WAITS                     |</span><br><span class="line">| INNODB_SYS_TABLESTATS                 |</span><br><span class="line">| INNODB_CMP                            |</span><br><span class="line">| INNODB_METRICS                        |</span><br><span class="line">| INNODB_CMP_RESET                      |</span><br><span class="line">| INNODB_CMP_PER_INDEX                  |</span><br><span class="line">| INNODB_CMPMEM_RESET                   |</span><br><span class="line">| INNODB_FT_DELETED                     |</span><br><span class="line">| INNODB_BUFFER_PAGE_LRU                |</span><br><span class="line">| INNODB_SYS_FOREIGN                    |</span><br><span class="line">| INNODB_SYS_COLUMNS                    |</span><br><span class="line">| INNODB_SYS_INDEXES                    |</span><br><span class="line">| INNODB_FT_DEFAULT_STOPWORD            |</span><br><span class="line">| INNODB_SYS_FIELDS                     |</span><br><span class="line">| INNODB_CMP_PER_INDEX_RESET            |</span><br><span class="line">| INNODB_BUFFER_PAGE                    |</span><br><span class="line">| INNODB_CMPMEM                         |</span><br><span class="line">| INNODB_FT_INDEX_TABLE                 |</span><br><span class="line">| INNODB_FT_BEING_DELETED               |</span><br><span class="line">| INNODB_SYS_TABLESPACES                |</span><br><span class="line">| INNODB_FT_INDEX_CACHE                 |</span><br><span class="line">| INNODB_SYS_FOREIGN_COLS               |</span><br><span class="line">| INNODB_SYS_TABLES                     |</span><br><span class="line">| INNODB_BUFFER_POOL_STATS              |</span><br><span class="line">| INNODB_FT_CONFIG                      |</span><br><span class="line">+<span class="comment">---------------------------------------+</span></span><br><span class="line">59 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h1 id="在-information-schema-库中查看索引信息"><a href="#在-information-schema-库中查看索引信息" class="headerlink" title="在 information_schema 库中查看索引信息"></a>在 information_schema 库中查看索引信息</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> information_schema.INNODB_SYS_INDEXES <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'sellerID'</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> crmErrLogOuter;</span><br></pre></td></tr></table></figure>
<h1 id="在-information-schema-库中查看表信息"><a href="#在-information-schema-库中查看表信息" class="headerlink" title="在 information_schema 库中查看表信息"></a>在 information_schema 库中查看表信息</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> information_schema.TABLES <span class="keyword">WHERE</span> table_name =<span class="string">'crmErrLogOuter'</span> <span class="keyword">and</span> table_schema=<span class="string">'crm'</span>;</span><br></pre></td></tr></table></figure>
<h1 id="查询表中数据超过-1000-行的表"><a href="#查询表中数据超过-1000-行的表" class="headerlink" title="查询表中数据超过 1000 行的表"></a>查询表中数据超过 1000 行的表</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_schema,table_name,table_rows <span class="keyword">from</span> information_schema.tables </span><br><span class="line"><span class="keyword">where</span> table_rows &gt; <span class="number">1000</span> </span><br><span class="line"><span class="keyword">and</span> table_schema != <span class="string">'performance_schema'</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> table_rows <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>
<h1 id="查询所有没有主键的表"><a href="#查询所有没有主键的表" class="headerlink" title="查询所有没有主键的表"></a>查询所有没有主键的表</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.table_schema, t.table_name</span><br><span class="line"><span class="keyword">FROM</span> information_schema.TABLES t</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> information_schema.TABLE_CONSTRAINTS tc <span class="keyword">ON</span> t.table_schema = tc.table_schema <span class="keyword">AND</span> t.table_name = tc.table_name <span class="keyword">AND</span> tc.constraint_type = <span class="string">'PRIMARY KEY'</span></span><br><span class="line"><span class="keyword">WHERE</span> tc.constraint_name <span class="keyword">IS</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">AND</span> t.table_type = <span class="string">'BASE TABLE'</span></span><br><span class="line"><span class="keyword">and</span> t.table_schema !=<span class="string">'performance_schema'</span>;</span><br></pre></td></tr></table></figure>
<h1 id="查询-5-个最大表"><a href="#查询-5-个最大表" class="headerlink" title="查询 5 个最大表"></a>查询 5 个最大表</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> table_schema, table_name, <span class="keyword">concat</span>(<span class="keyword">round</span>(data_length/(<span class="number">1024</span>*<span class="number">1024</span>),<span class="number">2</span>),<span class="string">'M'</span>) data_length   </span><br><span class="line"><span class="keyword">FROM</span> information_schema.TABLES</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> data_length <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>
<h1 id="查看连接情况"><a href="#查看连接情况" class="headerlink" title="查看连接情况"></a>查看连接情况</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> performance_schema.hosts;</span><br></pre></td></tr></table></figure>
<p>可以肯定的是，版本 5.1.73 没有库：performance_schema，版本 5.6.26 有。</p>
<h1 id="查看-MySQL-版本"><a href="#查看-MySQL-版本" class="headerlink" title="查看 MySQL 版本"></a>查看 MySQL 版本</h1><ol>
<li>登陆 mysql，进入命令模式 <ul>
<li>status;</li>
<li>select version();</li>
</ul>
</li>
<li><p>利用 mysql –help</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mysql --help | grep Distrib</span><br><span class="line">mysql  Ver 14.14 Distrib 5.1.73, for redhat-linux-gnu (x86_64) using readline 5.1</span><br></pre></td></tr></table></figure>
</li>
<li><p>包管理工具（redhat 系列）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># rpm -qa|grep mysql </span><br><span class="line">php-mysql-5.3.3-46.el6_6.x86_64</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="查看-mysql-现在已提供什么存储引擎"><a href="#查看-mysql-现在已提供什么存储引擎" class="headerlink" title="查看 mysql 现在已提供什么存储引擎"></a>查看 mysql 现在已提供什么存储引擎</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show engines;</span><br></pre></td></tr></table></figure>
<h1 id="查看-mysql-当前默认的存储引擎"><a href="#查看-mysql-当前默认的存储引擎" class="headerlink" title="查看 mysql 当前默认的存储引擎"></a>查看 mysql 当前默认的存储引擎</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &apos;%storage_engine%&apos;;</span><br></pre></td></tr></table></figure>
<h1 id="提升插入速度"><a href="#提升插入速度" class="headerlink" title="提升插入速度"></a>提升插入速度</h1><p><a href="http://www.cnblogs.com/suifengbingzhu/p/4182985.html" rel="external nofollow noopener noreferrer" target="_blank">参考：MYSQLinsert速度过慢</a></p>
<h2 id="MY-SQL-insert-速度过慢的解决方法"><a href="#MY-SQL-insert-速度过慢的解决方法" class="headerlink" title="MY SQL insert 速度过慢的解决方法"></a>MY SQL insert 速度过慢的解决方法</h2><p>最近在用MySQL做存储，测试中发现插入数据太慢了，插入速度只有20-30 条/秒，后来查资料后，将MySQL的1个参数：innodb_flush_log_at_trx_commit，从 1 改为了 0（修改方法，可以直接修改 my.ini(windows)/my.cnf(linux) 中的对应参数，似乎用命令直接设置没有效果），插入速度就提升到了3000+每S。</p>
<p>MySQL的文档，对这个参数的描述如下：<br>If the value of innodb_flush_log_at_trx_commit is 0, the log buffer is written out to the log file once per second and the flush to disk operation is performed on the log file, but nothing is done at a transaction commit. When the value is 1 (the default), the log buffer is written out to the log file at each transaction commit and the flush to disk operation is performed on the log file. When the value is 2, the log buffer is written out to the file at each commit, but the flush to disk operation is not performed on it. However, the flushing on the log file takes place once per second also when the value is 2. Note that the once-per-second flushing is not 100% guaranteed to happen every second, due to process scheduling issues.</p>
<p>如果transaction commit的频率非常高，1秒钟内会进行很多次的话，可以考虑将其设置为0，但这样就要承担数据库Crash后，1秒内未存储到数据库数据丢失可能的风险。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> innodb_flush_log_at_trx_commit=<span class="number">0</span>;</span><br></pre></td></tr></table></figure></p>
<h1 id="decimal-精度"><a href="#decimal-精度" class="headerlink" title="decimal 精度"></a>decimal 精度</h1><p>decimal(4,2)，整数部分只能输入两位数，小数部分只能输入两位，也就是说，小数加整数的位数等于第一位精度，在这里是 4。</p>
<h1 id="多表关联-update"><a href="#多表关联-update" class="headerlink" title="多表关联 update"></a>多表关联 update</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> courseDetail cd </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> course c <span class="keyword">on</span> c.courseID = cd.courseID</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> <span class="keyword">organization</span> org <span class="keyword">on</span> org.orgID = c.orgID</span><br><span class="line"><span class="keyword">set</span> cd.classPlace = org.address;</span><br></pre></td></tr></table></figure>
<h1 id="密码强度"><a href="#密码强度" class="headerlink" title="密码强度"></a>密码强度</h1><p>mysql5.7 默认安装了密码安全检查插件（validate_password），默认密码检查策略要求密码必须包含：大小写字母、数字和特殊符号，并且长度不能少于8位。否则会提示以下 错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1819 (HY000): Your password does not satisfy the current policy requirements</span><br></pre></td></tr></table></figure></p>
<p>必须先改默认密码，才能做别的操作。<br>参考：<a href="/database/centOS7InstallMySQL5.7.20">CentOS7 安装 MySQL-5.7.20</a></p>
<h1 id="查看错误日志文件路径"><a href="#查看错误日志文件路径" class="headerlink" title="查看错误日志文件路径"></a>查看错误日志文件路径</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &apos;log_error&apos;;</span><br><span class="line">+---------------+---------------------+</span><br><span class="line">| Variable_name | Value               |</span><br><span class="line">+---------------+---------------------+</span><br><span class="line">| log_error     | /var/log/mysqld.log |</span><br><span class="line">+---------------+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h1 id="查看表结构"><a href="#查看表结构" class="headerlink" title="查看表结构"></a>查看表结构</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc mysql.user;</span><br></pre></td></tr></table></figure>
<h1 id="mysql-8-x-查看存储过程"><a href="#mysql-8-x-查看存储过程" class="headerlink" title="mysql 8.x 查看存储过程"></a>mysql 8.x 查看存储过程</h1><p>查看存储过程的创建代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create procedure proc_name;</span><br></pre></td></tr></table></figure></p>
<p>生成某个数据库的所有存储过程的【查看存储过程创建代码】，同时也就知道了该数据库一共有多少个存储过程。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT CONCAT(&apos;show create &apos; ,ROUTINE_TYPE  , &apos; `&apos;, ROUTINE_SCHEMA  ,&apos;`.`&apos;, `SPECIFIC_NAME`,&apos;`;&apos;) showSql, ROUTINE_SCHEMA, ROUTINE_TYPE,SPECIFIC_NAME </span><br><span class="line">FROM information_schema.`ROUTINES`</span><br><span class="line">WHERE `ROUTINE_TYPE` =&apos;PROCEDURE&apos; and `ROUTINE_SCHEMA` =&apos;your_db_name&apos;;</span><br></pre></td></tr></table></figure></p>
<h1 id="查看函数的创建代码"><a href="#查看函数的创建代码" class="headerlink" title="查看函数的创建代码"></a>查看函数的创建代码</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create function func_name;</span><br></pre></td></tr></table></figure>
<h1 id="mysqldump-导出数据"><a href="#mysqldump-导出数据" class="headerlink" title="mysqldump 导出数据"></a>mysqldump 导出数据</h1><ol>
<li><p>导出某库中的多表，表结构和数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump --default-character-set=utf8 -h192.168.1.130 -uroot -proot schemaName tableName1 tableName2 tableName3 &gt; d:/schemaName.sql</span><br></pre></td></tr></table></figure>
</li>
<li><p>某库中的全部表结构和数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump --default-character-set=utf8 -h127.0.0.1 -uroot -proot -B schemaName &gt; d:/schemaName.sql</span><br></pre></td></tr></table></figure>
</li>
<li><p>导出某表，带条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump --default-character-set=utf8 -h127.0.0.1 -uroot -proot schemaName tableName1 --where=&quot;id=80&quot; &gt; d:/schemaName.sql</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h1><ol>
<li><p>用 source 命令导入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 先连接上 mysql 再操作</span><br><span class="line">mysql&gt; use rate;</span><br><span class="line">mysql&gt; set names utf8mb4; -- 很重要，这样可以保证中文不会乱码</span><br><span class="line">mysql&gt; source D:\dev.workspace\sql.data\rt_top_tmc_message_queue_crm_his_20170723.sql</span><br></pre></td></tr></table></figure>
</li>
<li><p>用 <code>&lt;</code> 的方式直接导入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -hlocalhost -uroot -proot schemaName &lt; new.sql --default-character-set=utf8mb4</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h1><h2 id="远程连接权限设置"><a href="#远程连接权限设置" class="headerlink" title="远程连接权限设置"></a>远程连接权限设置</h2><p>允许 IP 为 192.168.1.89 的主机以 jiraUser 的身份连接所有库（*），密码是 <code>JiraUserAnDyDoCkEr123</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON *.* TO &apos;sjiraUer&apos;@&apos;192.168.1.89&apos; IDENTIFIED BY &apos;JiraUserAnDyDoCkEr123&apos; WITH GRANT OPTION;</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure></p>
<h2 id="查看-MYSQL-数据库用户远程连接权限"><a href="#查看-MYSQL-数据库用户远程连接权限" class="headerlink" title="查看 MYSQL 数据库用户远程连接权限"></a>查看 MYSQL 数据库用户远程连接权限</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT DISTINCT CONCAT('User: ''',user,'''@''',host,''';') AS user FROM mysql.user;</span><br><span class="line">+<span class="comment">-------------------------------+</span></span><br><span class="line">| user                          |</span><br><span class="line">+<span class="comment">-------------------------------+</span></span><br><span class="line">| User: 'rate'@'%';             |</span><br><span class="line">| User: 'root'@'127.0.0.1';     |</span><br><span class="line">| User: 'root'@'192.168.0.168'; |</span><br><span class="line">| User: 'redmine'@'localhost';  |</span><br><span class="line">| User: 'root'@'localhost';     |</span><br><span class="line">+<span class="comment">-------------------------------+</span></span><br></pre></td></tr></table></figure>
<h3 id="2019-06-10-补充"><a href="#2019-06-10-补充" class="headerlink" title="2019-06-10 补充"></a>2019-06-10 补充</h3><p>或者用以下语句更直接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select host,user from mysql.user;</span><br><span class="line">+---------------+---------------+</span><br><span class="line">| host          | user          |</span><br><span class="line">+---------------+---------------+</span><br><span class="line">| 192.168.0.101 | admin         |</span><br><span class="line">| 192.168.0.168 | admin         |</span><br><span class="line">| localhost     | mysql.session |</span><br><span class="line">| localhost     | mysql.sys     |</span><br><span class="line">| localhost     | root          |</span><br><span class="line">+---------------+---------------+</span><br></pre></td></tr></table></figure></p>
<h3 id="直接修改授权-IP"><a href="#直接修改授权-IP" class="headerlink" title="直接修改授权 IP"></a>直接修改授权 IP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update mysql.user set host=&apos;192.168.1.89&apos; where host=&apos;192.168.0.101&apos;;</span><br><span class="line">Query OK, 1 row affected (0.33 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br></pre></td></tr></table></figure>
<h2 id="删除授权"><a href="#删除授权" class="headerlink" title="删除授权"></a>删除授权</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Delete FROM mysql.user Where User=&quot;root&quot; and Host=&quot;192.168.0.168&quot;;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"># CentOS7 忘记 mysql5.7 root 密码，重置密码</span><br></pre></td></tr></table></figure>
<p>vim /etc/my.cnf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在 `[mysqld]` 节点的最后，添加：`skip-grant-tables`</span><br><span class="line">重启 mysql：`systemctl restart mysqld`</span><br><span class="line"></span><br><span class="line">登录并修改MySQL的 root 密码，直接输入 mysql 并回车：</span><br></pre></td></tr></table></figure></p>
<p>[root@AndyCentOS7Basic ~]# mysql<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 3<br>Server version: 5.7.20 MySQL Community Server (GPL)</p>
<p>Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.</p>
<p>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.</p>
<p>Type ‘help;’ or ‘\h’ for help. Type ‘\c’ to clear the current input statement.</p>
<p>mysql&gt; USE mysql;<br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A</p>
<p>Database changed<br>mysql&gt; update mysql.user set authentication_string=password(‘your new password’) where user=’root’;<br>Query OK, 1 row affected, 1 warning (0.00 sec)<br>Rows matched: 1  Changed: 1  Warnings: 1</p>
<p>mysql&gt; flush privileges;<br>Query OK, 0 rows affected (0.00 sec)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">其中</span><br><span class="line">- 修改密码：`update mysql.user set authentication_string=password(&apos;your new password&apos;) where user=&apos;root&apos;;`</span><br><span class="line">- 刷新权限：`flush privileges;`</span><br><span class="line"></span><br><span class="line">编辑mysql配置文件，将之前添加的skip-grant-tables去掉。</span><br><span class="line">重启 mysql：`systemctl restart mysqld`</span><br><span class="line"></span><br><span class="line"># mysql8 忘记密码</span><br><span class="line">跟 mysql5.7的操作步骤差不多，只是在修改密码的语句上有差别。</span><br><span class="line">mysql8 修改密码的语句为：`alter user &apos;root&apos;@&apos;%&apos; IDETIFIED BY &apos;新密码&apos;;`</span><br><span class="line">在修改之前，用`select host,user from user;`查一下已有用户。</span><br></pre></td></tr></table></figure></p>
<p>mysql&gt;use mysql;<br>mysql&gt;select host,user from user;<br>+———–+——————+<br>| host      | user             |<br>+———–+——————+<br>| %         | root             |<br>| localhost | mysql.infoschema |<br>| localhost | mysql.session    |<br>| localhost | mysql.sys        |<br>+———–+——————+<br>mysql&gt; flush privileges;<br>mysql&gt; alter user ‘root‘@’%’ IDETIFIED BY ‘your new password’;<br>mysql&gt; exit;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># mysql8.0.11 导数据报错：Unknown table &apos;COLUMN_STATISTICS&apos; in information_schema (1109)</span><br><span class="line">## 现象</span><br><span class="line">- windows 10 的 mysql 版本为 8.0.11，导出服务器上的 5.7.20 版本的数据，得到这个错。</span><br><span class="line">- 换用 secureCRT 直接操作服务器上的 mysql（5.7.20），顺利导出。</span><br></pre></td></tr></table></figure></p>
<p>C:\Users\AndyChen&gt;mysqldump –default-character-set=utf8mb4 -h192.168.1.88 -uadmin -paAdDmMiInN1!1!0)3# mysqlDatabase &gt; c:/workspace/mysqlDatabase.sql<br>mysqldump: [Warning] Using a password on the command line interface can be insecure.<br>mysqldump: Couldn’t execute ‘SELECT COLUMN_NAME, JSON_EXTRACT(HISTOGRAM, ‘$.”number-of-buckets-specified”‘)<br>FROM information_schema.COLUMN_STATISTICS<br>WHERE SCHEMA_NAME = ‘mysqlDatabase’ AND TABLE_NAME = ‘sys_menu’;’: Unknown table ‘COLUMN_STATISTICS’ in information_schema (1109)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">在网上查了一下，原来 mysql8.0 之前的版本是没问题的。</span><br><span class="line"></span><br><span class="line">## 解决办法</span><br><span class="line">在导出语句添加：`--column-statistics=0`</span><br><span class="line">格式为：</span><br></pre></td></tr></table></figure></p>
<p>mysqldump –column-statistics=0 –default-character-set=utf8mb4 -h192.168.1.88 -uadmin -paAdDmMiInN1!1!0)3# mysqlDatabase &gt; c:/workspace/ginadmin.sql<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">测试无误~~</span><br><span class="line"></span><br><span class="line"># 阿里云数据库，RDS 不能保存微信特殊字符 emoji</span><br><span class="line">原因：数据库编码为utf-8不支持ios的emoji</span><br><span class="line"></span><br><span class="line">在 RDS 实例控制台 -&gt; 参数设置 , 的【character_set_server】项，将 utf8 改为：utf8mb4，改好后，点击【提交参数】。</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">* 如果在创建数据库之前没有设置该参数，即使创建数据库时指定为 utf8mb4，也无济于事。</span><br><span class="line">* 该参数修改后, 仅对开启高权限账号的实例后来创建的数据库有效. 对当前数据库无效。</span><br><span class="line"></span><br><span class="line">可对字段单独修改，如：</span><br></pre></td></tr></table></figure></p>
<p>ALTER TABLE <code>member</code> CHANGE <code>wxNickname</code> <code>wxNickname</code> varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># Mysql中字符串正确的连接方法</span><br><span class="line">在Mysql中，使用“+”进行字符连接时，mysql会尝试将字段值转换为数字类型（如果转换失败，就当做数字0处理）。如’1abc’+’22′，mysql将“1abc”转成数字1在进行运算；将“abc”当做0处理。 </span><br><span class="line"></span><br><span class="line">在MYSQL中进行字符串的拼接要使用CONCAT函数，CONCAT函数支持一个或者多个参数，参数类型可以为字符串类型也可以是非字符串类型，对于非字符串类型的参数MYSQL将尝试将其转化为字符串类型，CONCAT函数会将所有参数按照参数的顺序拼接成一个字符串做为返回值。</span><br><span class="line"></span><br><span class="line">参考：https://www.cnblogs.com/zhengah/p/5199843.html</span><br><span class="line"></span><br><span class="line"># 生成批量修改备注的语句</span><br><span class="line">mysql 批量清空字段的备注 comment</span><br><span class="line">里面有个TABLE_COMMENT，就是表的注释，想批量修改直接update这个表的这个字段；</span><br><span class="line">同理，字段的注释在information_schema.COLUMNS这个表中。</span><br></pre></td></tr></table></figure></p>
<p>SELECT<br>concat(<br>    ‘alter table ‘,<br>    table_schema, ‘.’, table_name,<br>    ‘ modify column ‘, column_name, ‘ ‘, column_type, ‘ ‘,<br>    if(is_nullable = ‘YES’, ‘ ‘, ‘not null ‘),<br>    if(column_default IS NULL, ‘’,<br>        if(<br>            data_type IN (‘char’, ‘varchar’)<br>            OR<br>            data_type IN (‘date’, ‘datetime’, ‘timestamp’) AND column_default != ‘CURRENT_TIMESTAMP’,<br>            concat(‘ default ‘’’, column_default,’’’’),<br>            concat(‘ default ‘, column_default)<br>        )<br>    ),<br>    if(extra is null or extra=’’,’’,concat(‘ ‘,extra)),<br>    ‘ comment ‘’’’;’ – 本句会将备注设置为空<br>    – ‘ comment ‘’’, column_comment, ‘’’;’ – 本句会带出原来的备注<br>) s<br>FROM information_schema.columns<br>WHERE table_schema = ‘mis’ AND table_name = ‘news’;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># com.alibaba.druid.pool.DruidDataSourceStatLoggerImpl</span><br><span class="line">日志，会不断的打印，如何屏蔽掉？</span><br></pre></td></tr></table></figure></p>
<p>14:35:48,944 &lt;com.alibaba.druid.pool.DruidDataSourceStatLoggerImpl&gt;  INFO [Druid-ConnectionPool-Log-1351788685]: {“url”:”jdbc:mysql://localhost:3306/csist_mis?allowPublicKeyRetrieval=true&amp;useSSL=false&amp;serverTimezone=GMT%2b8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;allowMultiQueries=true&amp;autoReconnect=true&amp;failOverReadOnly=false&amp;socketTimeout=20000”,”dbType”:”mysql”,”name”:”DataSource-1351788685”,”activeCount”:0,”poolingCount”:1,”connectCount”:0,”closeCount”:0}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">参见官网文档：https://www.bookstack.cn/read/Druid/70242a8b751bf5ca.md</span><br><span class="line">取消 timeBetweenLogStatsMillis 的配置即可取消定时打印日志</span><br><span class="line"></span><br><span class="line"># Caused by: com.mysql.cj.exceptions.CJException: Public Key Retrieval is not allowed</span><br><span class="line">连接 mysql 报错</span><br></pre></td></tr></table></figure></p>
<p>Caused by: com.mysql.cj.exceptions.CJException: Public Key Retrieval is not allowed<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">连接数据库的url中，加上allowPublicKeyRetrieval=true参数，经过验证解决该问题。</span><br><span class="line"></span><br><span class="line"># MySQL Tinyint的取值范围是</span><br><span class="line">在 MySQL 的数据类型中，Tinyint的取值范围是：带符号的范围是-128到127。无符号的范围是0到255。</span><br><span class="line"></span><br><span class="line">[见官方《MySQL 5.1参考手册》](http://dev.mysql.com/doc/refman/5.1/zh/column-types.html#numeric-types)</span><br><span class="line"></span><br><span class="line"># MYSql 日期类型精度</span><br><span class="line">- TIMESTAMP(3)与 DATETIME(3)意思是保留3位毫秒数。</span><br><span class="line">- TIMESTAMP(6)与 DATETIME(6)意思是保留6位毫秒数。</span><br><span class="line">- 通过 MyBatis 更新带毫秒的时间，结果还是只到秒。</span><br><span class="line">- 手工更新，也还是只精确到秒。</span><br><span class="line"></span><br><span class="line">暂时通过添加字符类型的字段来保留到毫秒级的时间数据。</span><br><span class="line"></span><br><span class="line"># PowerDesigner 连接 MySQL下载 ODBC 驱动</span><br><span class="line">[oracle mysql ODBC driver](https://dev.mysql.com/downloads/connector/odbc/)</span><br><span class="line">MYSQL Connector/ODBC 提供了两个版本，一个是 ANSI driver  和 Unicode driver 两个版本。  </span><br><span class="line">Unicode driver 版本提供了更多字符集的支持，也就是提供了多语言的支持。而ANSI driver 版本是只针对有限的字符集的范围。</span><br><span class="line"></span><br><span class="line"># mysql 慢查询优化</span><br><span class="line">以下是 C# 里的 EF 查询表达式</span><br></pre></td></tr></table></figure></p>
<p>// 不加 will_rate_time &gt;= willRateTimeStart，在有接近300万条记录时，查询非常慢，每次查询需要扫描大于一半的记录，达到160多万条。加上之后，跨度只有一天时间后，扫描行数变成5万左右。<br>// 不加 will_rate_time &gt;= willRateTimeStart，直接在 MySqlWorkbench 上查询，花了144秒（加上limit 15000)，而在开发环境查询，仅需要不到5秒时间。<br>// 不加之前，应用程序一直报错：An error occurred while reading from the store provider’s data reader. See the inner exception for details.<br>// 这是超时导致。<br>// will_rate_time 字段有索引<br>var query = from om in ctx.rt_on_messages.AsNoTracking()<br>            where om.is_rate_switch_on == 1<br>            &amp;&amp; om.is_seller_rate.Value == 0<br>            &amp;&amp; om.is_session_key_null == 0<br>            &amp;&amp; om.rate_failed_times &lt; MaxRateFailedTimes<br>            &amp;&amp; om.will_rate_time &gt;= willRateTimeStart<br>            &amp;&amp; om.will_rate_time &lt; willRateTimeEnd<br>            &amp;&amp; om.rate_result &gt; 0<br>            //&amp;&amp; arrTid.Contains(om.tid)<br>            //&amp;&amp; om.will_rate_time &gt; -1<br>            select om;</p>
<p>//.OrderByDescending(o =&gt; o.publish_time)<br>return query.Take(MessageTopRecords).ToList&lt;rt_on_messages&gt;();<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看是否开启慢查询</span><br></pre></td></tr></table></figure></p>
<p>mysql&gt; show variables like ‘%log_slow_queries%’;<br>+——————+——-+<br>| Variable_name    | Value |<br>+——————+——-+<br>| log_slow_queries | ON    |<br>+——————+——-+<br>1 row in set (0.00 sec)</p>
<p>mysql&gt;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">开启慢查询非常简单, 操作如下:</span><br><span class="line">Linux下找到mysql的配置文件my.ini, 在mysqld下方加入慢查询的配置语句(注意:一定要在[mysqld]下的下方加入)</span><br></pre></td></tr></table></figure></p>
<p>log-slow-queries=/mnt/mysqlLog/slowQueries.log<br>long_query_time=10<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">log-slow-queries: 代表MYSQL慢查询的日志存储目录, 此目录文件一定要有写权限；</span><br><span class="line">long_query_time: 最长执行时间.</span><br><span class="line">MSYQL将记录下所有执行时间超过long_query_time秒的SQL语句, 此处为测试时间, 时间不应太小最好在5-10秒之内, 当然可以根据自己的标准而定</span><br><span class="line">MySQL 慢查询的相关参数解释：</span><br><span class="line"></span><br><span class="line">* slow_query_log    ：是否开启慢查询日志，1表示开启，0表示关闭。</span><br><span class="line">* log-slow-queries  ：旧版（5.6以下版本）MySQL数据库慢查询日志存储路径。可以不设置该参数，系统则会默认给一个缺省的文件host_name-slow.log</span><br><span class="line">* slow-query-log-file：新版（5.6及以上版本）MySQL数据库慢查询日志存储路径。可以不设置该参数，系统则会默认给一个缺省的文件host_name-slow.log</span><br><span class="line">* long_query_time ：慢查询阈值，当查询时间多于设定的阈值时，记录日志。</span><br><span class="line">* log_queries_not_using_indexes：未使用索引的查询也被记录到慢查询日志中（可选项）。</span><br><span class="line">* log_output：日志存储方式。log_output=&apos;FILE&apos;表示将日志存入文件，默认值是&apos;FILE&apos;。log_output=&apos;TABLE&apos;表示将日志存入数据库，这样日志信息就会被写入到mysql.slow_log表中。MySQL数据库支持同时两种日志存储方式，配置的时候以逗号隔开即可，如：log_output=&apos;FILE,TABLE&apos;。日志记录到系统的专用日志表中，要比记录到文件耗费更多的系统资源，因此对于需要启用慢查询日志，又需要能够获得更高的系统性能，那么建议优先记录到文件。</span><br><span class="line"></span><br><span class="line">慢查询日志配置</span><br><span class="line"></span><br><span class="line">默认情况下slow_query_log的值为OFF，表示慢查询日志是禁用的，可以通过设置slow_query_log的值来开启，如下所示：</span><br></pre></td></tr></table></figure></p>
<p>mysql&gt; show variables  like ‘%slow_query_log%’;<br>+———————+———————————+<br>| Variable_name       | Value                           |<br>+———————+———————————+<br>| slow_query_log      | ON                              |<br>| slow_query_log_file | /var/run/mysqld/mysqld-slow.log |<br>+———————+———————————+</p>
<p>mysql&gt; set global slow_query_log=1;<br>mysql&gt; set global long_query_time=4;<br>mysql&gt; show variables like ‘long_query_time%’;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># C# 连接 MySQL 异常</span><br><span class="line">原因是MySQL 压力太大，有慢查询，cpu 使用率接近100%。  </span><br><span class="line">以下是 C# 捕获的异常信息。</span><br></pre></td></tr></table></figure></p>
<p>– ===================================<br>时间:           2017/6/29 11:27:32<br>错误号:         1000<br>标题:           An error occurred while reading from the store provider’s data reader. See the inner exception for details.<br>内容:           An error occurred while reading from the store provider’s data reader. See the inner exception for details.<br>EntityFramework<br>   在 System.Data.Entity.Core.Common.Internal.Materialization.Shaper<code>1.HandleReaderException(Exception e)
   在 System.Data.Entity.Core.Common.Internal.Materialization.Shaper</code>1.StoreRead()<br>   在 System.Data.Entity.Core.Common.Internal.Materialization.Shaper<code>1.SimpleEnumerator.MoveNext()
   在 System.Data.Entity.Internal.LazyEnumerator</code>1.MoveNext()<br>   在 System.Collections.Generic.List<code>1..ctor(IEnumerable</code>1 collection)<br>   在 System.Linq.Enumerable.ToList<a href="IEnumerable`1 source">TSource</a><br>   在 Maile360.Rate.DAL.OnMessagesDAL.GetOnMessagesList()<br>   在 Maile360.Rate.Logic.Common.OnMessagesDealLogic.Run()<br>   在 Maile360.Rate.RealtimeService.OrdersToBeRateService.Go()<br>出现错误的位置: OnMessagesWaitingUpdateService<br>错误级别:       urgency<br>– =====================================<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># Windows 下 MySql 设置表名区分大小写</span><br><span class="line">windows 下，默认表名不区分大小写但字段大小写与创建时一致。</span><br><span class="line">在 mysql 主目录下修改 my.ini，在配置项 [mysqld] 下添加：lower_case_table_names=0</span><br><span class="line"></span><br><span class="line">换最新版本再试</span><br><span class="line"></span><br><span class="line">`mysql 5.6` 添加上面的配置后，启动失败，提示1067</span><br><span class="line"></span><br><span class="line">`lower_case_table_names`，参数含义如下：</span><br><span class="line">1. 0：使用`CREATE TABLE`或`CREATE DATABASE`语句指定的大小写字母在硬盘上保存表名和数据库名。名称比较对大小写敏感。在大小写不敏感的操作系统如windows或Mac OS x上我们不能将该参数设为0，如果在大小写不敏感的文件系统上将`--lowercase-table-names`强制设为0，并且使用不同的大小写访问MyISAM表名，可能会导致索引破坏。</span><br><span class="line">1. 1：表名在硬盘上以小写保存，名称比较对大小写不敏感。MySQL将所有表名转换为小写在存储和查找表上。该行为也适合数据库名和表的别名。该值为Windows的默认值。</span><br><span class="line">1. 2：表名和数据库名在硬盘上使用`CREATE TABLE`或`CREATE DATABASE`语句指定的大小写字母进行保存，但MySQL将它们转换为小写在查找表上。名称比较对大小写不敏感，即按照大小写来保存，按照小写来比较。注释：只在对大小写不敏感的文件系统上适用! innodb表名用小写保存。</span><br><span class="line"></span><br><span class="line"># PowerDesigner 生成数据库时的列中文注释乱码问题的设置方法</span><br><span class="line">`PowerDesinger-&gt;Database-&gt;Generate Database-&gt;Format-&gt;Encoding` 改成 utf8</span><br><span class="line">![][/img/powerDesignDatabaseGenerationFormatToUtf8.jpg]</span><br><span class="line"></span><br><span class="line"># mysql The server time zone value</span><br></pre></td></tr></table></figure></p>
<p>The server time zone value ‘ÖÐ¹ú±ê×¼Ê±¼ä’ is unrecognized or represents more than one time zone.<br><code>`</code><br>在连接后面加上：<code>?useSSL=false&amp;serverTimezone=GMT&amp;useUnicode=true&amp;characterEncoding=utf8&amp;allowMultiQueries=true&amp;autoReconnect=true&amp;failOverReadOnly=false&amp;socketTimeout=20000</code></p>
<h1 id="MySQL-获取当前年"><a href="#MySQL-获取当前年" class="headerlink" title="MySQL 获取当前年"></a>MySQL 获取当前年</h1><p><code>SELECT DATE_FORMAT(NOW(), &#39;%Y&#39;) as year;</code></p>
<h1 id="MySQL-int-后面的数字与前导零填充"><a href="#MySQL-int-后面的数字与前导零填充" class="headerlink" title="MySQL int 后面的数字与前导零填充"></a>MySQL int 后面的数字与前导零填充</h1><p>字段加属性：zerofill，如：<code>current_value        int(6) unsigned zerofill  comment &#39;当前值&#39;,</code></p>
<h1 id="ERROR-1273-HY000-Unknown-collation-‘utf8mb4-0900-ai-ci’"><a href="#ERROR-1273-HY000-Unknown-collation-‘utf8mb4-0900-ai-ci’" class="headerlink" title="ERROR 1273 (HY000): Unknown collation: ‘utf8mb4_0900_ai_ci’"></a>ERROR 1273 (HY000): Unknown collation: ‘utf8mb4_0900_ai_ci’</h1><p>将 MySQL 8.X 的 mysqldump 文件导入 MySQL 5.7 报的错，8.x 的字符编码设置为 utf8mb4 了。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>打开sql文件，将文件中的所有 utf8mb4_0900_ai_ci 替换为 utf8_general_ci，utf8mb4 替换为 utf8</p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-09-01T02:53:12.919Z" itemprop="dateUpdated">2020年9月1日 10:53</time>
</span><br>


        转载请注明出处：<a href="/database/experience.html" target="_blank" rel="external">https://www.lovesofttech.com/database/experience.html</a>
    </div>
    <footer>
        <a href="https://www.lovesofttech.com">
            <img src="/img/myLogo.jpg" alt="安迪陈">
            安迪陈
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/">MySQL</a></li></ul>

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://www.lovesofttech.com/database/experience.html&title=《MySQL 常用脚本，日常经验》 — 安迪陈技术日志，架构、感悟、系统分析、团队管理&pic=https://www.lovesofttech.com/img/myLogo.jpg" data-title="微博" rel="external nofollow noopener noreferrer">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.lovesofttech.com/database/experience.html&title=《MySQL 常用脚本，日常经验》 — 安迪陈技术日志，架构、感悟、系统分析、团队管理&source=MySQL 高频脚本备忘录，以及日常经验备忘。" data-title=" QQ" rel="external nofollow noopener noreferrer">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://www.lovesofttech.com/database/experience.html" data-title=" Facebook" rel="external nofollow noopener noreferrer">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《MySQL 常用脚本，日常经验》 — 安迪陈技术日志，架构、感悟、系统分析、团队管理&url=https://www.lovesofttech.com/database/experience.html&via=https://www.lovesofttech.com" data-title=" Twitter" rel="external nofollow noopener noreferrer">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://www.lovesofttech.com/database/experience.html" data-title=" Google+" rel="external nofollow noopener noreferrer">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>


        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/linux/centOSVersion.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">如何查看已安装的 CentOS 版本信息</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/mybatis/MBGTableKeepOriginal.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">MyBatis Generator (MBG)，修改源码以适应 MySQL 大小写敏感配置的各种情况、适应分表时动态替换表名</h4>
      </a>
    </div>
  
</nav>


    
    



</article>



</div>

        <footer class="footer">
    <div class="bottom">
        <p>
            <span>安迪陈技术日志，架构、感悟、系统分析、团队管理 &copy; 2017 - 2020</span>
            <span>
                Power by <a href="https://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a>&nbsp;
                Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank" rel="external nofollow noopener noreferrer">indigo</a>
            </span>
            <span>
                <a href="https://beian.miit.gov.cn" target="_blank" rel="external nofollow noopener noreferrer">蜀ICP备17041860号</a>
            </span>
            
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            </p><p>
                <span>
                    统计始于：2019-03-06
                </span>
                <span id="busuanzi_container_site_uv" style="display:none">
                    访客数：<span id="busuanzi_value_site_uv"></span>
                </span>
                <span id="busuanzi_container_site_pv" style="display:none">
                    访问量：<span id="busuanzi_value_site_pv"></span>
                </span>
            
            
                <span class="post-count">累计字数：311.5k</span>
            
                <span><a href="/general/blogLog.html"><i class="fas fa-pen-alt"></i>&nbsp;博客日志</a></span>
            </p>
        <p></p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light" title="回到顶部"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://www.lovesofttech.com/database/experience.html&title=《MySQL 常用脚本，日常经验》 — 安迪陈技术日志，架构、感悟、系统分析、团队管理&pic=https://www.lovesofttech.com/img/myLogo.jpg" data-title="微博" rel="external nofollow noopener noreferrer">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.lovesofttech.com/database/experience.html&title=《MySQL 常用脚本，日常经验》 — 安迪陈技术日志，架构、感悟、系统分析、团队管理&source=MySQL 高频脚本备忘录，以及日常经验备忘。" data-title=" QQ" rel="external nofollow noopener noreferrer">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://www.lovesofttech.com/database/experience.html" data-title=" Facebook" rel="external nofollow noopener noreferrer">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《MySQL 常用脚本，日常经验》 — 安迪陈技术日志，架构、感悟、系统分析、团队管理&url=https://www.lovesofttech.com/database/experience.html&via=https://www.lovesofttech.com" data-title=" Twitter" rel="external nofollow noopener noreferrer">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://www.lovesofttech.com/database/experience.html" data-title=" Google+" rel="external nofollow noopener noreferrer">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJElEQVR42u3aQY7lIAwFwH//S2cO0Ap5tpORQopVq8UnFAvLxvx+8ThOxnpOvvLfFX5PDAwMjNcyjuXozekdwRp2cUwYGBgfYCShcD5//duzo1l/CwMDA+NsTh5Y1wG0+l0MDAyMuwJu/v91comBgYFRDZRJsTpf8/FaHAMD44WM3vX9//n7kf4GBgbGqxhHcVSL2EnhWtgVBgbG1ow8wFWTs6QcrRa96/UxMDD2Zsy3Xg2vSchOZo4SRwwMjBcy8gDau/zKr95GIRsDA2NrRm+5vOmYbCVpP2BgYHyTcVfozNuTk5O+uG7DwMDYlFG9MsvTtep282ZDs8GJgYHxQkb+3OGuh1l5EVtIQzEwMLZmVC/l8wemOX6eIGJgYOzNKFtbmVh+bZdf/EWvRTAwMLZgJKG2mgjOWwXVdgIGBsbejF7ArRa3eZMgD/SntTgGBsZ2jN6lWLW5ODmUPKxjYGB8gZEXmZMWwvx5WbkxgIGBsSmj+sBrfsVfrUYvHl5gYGBsx1gHzbz4nKSJyRcvjgYDA+MDjElzsReyq80JDAwMjOpGJ1dm1bQySiUxMDA2ZRzF0UzaiqNcJGNgYGzNmCzdg1UfgfWSVAwMjP0YeZCdUOcBt1CLY2BgbMroBb7eE64J+PRXGBgYGMWNVsN0ckAXq2FgYGDc9PC0F2qjghkDA+MDjPxCLY941Y3mSAwMjK8x8tLxuUysWvSO+hsYGBhvYvwD6gcNy//qRZgAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="/js/main.min.js?v=1.5.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.5.2" async></script>





<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '安迪陈技术日志';
            clearTimeout(titleTime);
        } else {
            document.title = '欢迎回来';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
